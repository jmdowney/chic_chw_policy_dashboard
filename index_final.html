<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>CHW Policy Dashboard</title>
  <meta name="viewport" content="initial-scale=1,width=device-width">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Anton' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css?family=Playfair Display" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
  <script src="https://cdn.rawgit.com/Keyang/node-csvtojson/d41f44aa/browser/csvtojson.min.js"></script>

  <style>
    /* CSS Variables - Design System */
    :root {
      /* Colors */
      --color-primary: #4F2049;
      --color-primary-light: #340C2F;
      --color-secondary: #9272d9;
      --color-accent: #20BDC5;
      --color-warning: #F36744;
      --color-neutral: #999999;
      --color-light-gray: #dbdbdb;
      --color-background: #F4F1EB;
      --color-white: #ffffff;
      --color-black: #111111;
      
      /* Typography */
      --font-primary: 'Helvetica Neue', 'Arial Narrow', sans-serif;
      --font-display: 'Anton', sans-serif;
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      
      /* Border radius */
      --radius-sm: 3px;
      --radius-md: 5px;
      --radius-lg: 6px;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
      
      /* Transitions */
      --transition-fast: 0.15s ease;
      --transition-normal: 0.2s ease;
      --transition-slow: 0.3s ease;
    }

    /* Mobile */
    @media screen and (max-width: 768px) {

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0px;
        padding: 0px;
        background-color: var(--color-background);
      }

      .container {
        display: grid;
        grid-template-columns: repeat(4, minmax(0px, 1fr));
        grid-template-rows: 10vh 6vh 50vh 34vh;
        max-width: 100%;
      }

      .header {
        grid-column: 1 / span 4;
        display: grid;
      }

      .header-section {
        grid-row: 1;
        display: grid;
        align-content: center;
      }

      /* Child containers within header */
      .left {
        grid-column: 1 / span 1;
      }

      .middle {
        grid-column: 2 / span 3;
      }

      .right {
        grid-column: 1 / span 4;
        grid-row: 2 / span 1;
        display: grid;
        text-align: center;
        margin: .5em;
      }

      /* Map and sidebar */
      .content-section {
        grid-column: 1 / span 4;
        grid-row: 3 / span 2;
      }

      /* Total accredited & salaried */
      #totaltext {
        color: var(--color-primary-light);
        font-family: var(--font-display);
        font-size: 4.4vw;
        overflow-wrap: normal;
        vertical-align: middle;
        margin-top: .5rem;
        margin-bottom: .5rem;
        margin-right: .5rem;
        line-height: 1.1em;
      }

      #total-accredited-and-salaried {
        color: var(--color-background);
        font-family: var(--font-display);
        font-size: 4vw;
        text-align: center;
        vertical-align: middle;
        background-color: var(--color-secondary);
        margin: .5rem;
        padding: .5rem;
        border-radius: var(--radius-sm);
      }

      /* "Submit additional country details" link design */
      .submitlink {
        place-self: center;
        background-color: var(--color-accent);
        font-family: var(--font-primary);
        vertical-align: middle;
        font-size: .6rem;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: var(--radius-lg);
        padding: .25rem;
        width: 100%;
      }

      #submitlink a {
        color: var(--color-background);
      }

      .right a:link {
        text-decoration: none;
      }

      .right a:visited {
        text-decoration: none;
      }

      /* Map positioning */
      #map {
        grid-column: 1 / span 4;
        grid-row: 3 / span 1;
        height: 100%;
      }

      /* Button design (map buttons) */
      .button {
        background-color: var(--color-background);
        color: var(--color-black);
        padding-top: .25em;
        padding-bottom: .25em;
        padding-right: .5em;
        padding-left: .5em;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-sm);
        font-family: var(--font-primary);
        font-size: .5rem;
        font-weight: bold;
        text-align: center;
        margin: 0;
        opacity: 0.8;
      }

      .button.active {
        background: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-primary);
        font-weight: bold;
        opacity: 1;
      }

      #buttoncontainer {
        position: absolute;
        top: 16%;
        left: 0;
        margin-left: .5em;
      }

      /* Search bar design */
      .searchcontainer {
        position: absolute;
        top: 24%;
        left: 0;
        margin-left: .5em;
        width: 60%;
        z-index: 1000;
      }

      .search-input {
        width: 100%;
        padding: .5em;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-sm);
        font-family: var(--font-primary);
        font-size: .6rem;
        background-color: var(--color-background);
        color: var(--color-black);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 3px rgba(79, 32, 73, 0.3);
      }

      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: var(--color-background);
        border: 1px solid var(--color-black);
        border-top: none;
        border-radius: 0 0 var(--radius-sm) var(--radius-sm);
        max-height: 200px;
        overflow-y: auto;
        display: none;
        z-index: 1001;
      }

      .search-result-item {
        padding: .5em;
        cursor: pointer;
        font-family: var(--font-primary);
        font-size: .6rem;
        border-bottom: 1px solid var(--color-light-gray);
      }

      .search-result-item:hover {
        background-color: var(--color-primary);
        color: var(--color-background);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      /* Legend design */
      .legend {
        position: absolute;
        top: 47%;
        right: 3%;
        width: 40%;
        background: var(--color-white);
        margin-right: .5rem;
        overflow: auto;
        padding: .6em;
        font-family: var(--font-primary);
        font-size: .45rem;
      }

      #legend {
        box-shadow: var(--shadow-sm);
        line-height: 1.1em;
        margin-bottom: 1rem;
      }

      .legend-key {
        display: inline-block;
        border-radius: 20%;
        width: 10px;
        height: 10px;
        margin-right: 5px;
      }

      .legenditems {
        display: block;
      }

      h4 {
        margin-top: 5px;
        margin-bottom: 5px;
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        grid-column: 1 / span 4;
        grid-row: 4 / span 1;
        background-color: var(--color-background);
        color: var(--color-primary-light);
        padding: 2em;
        font-size: .8rem;
        overflow-y: auto;
        max-height: 100%;
        font-family: var(--font-primary);
        border-top: solid 1px var(--color-primary-light);
      }

      .country-details * {
        font-family: var(--font-primary);
        margin-bottom: .5em;
        line-height: 1.3em;
        overflow-wrap: normal;
      }

      .country-details {
        margin-bottom: 1rem;
      }

      #country-name {
        font-size: 1.2rem;
        text-transform: uppercase;
        font-family: var(--font-display);
      }

      .out-of-scope-text {
        font-style: italic;
        font-family: var(--font-primary);
        font-size: .8rem;
        color: var(--color-primary-light);
        margin-bottom: 1em;
      }

      /* Button design (sidebar buttons) */
      .buttonsidebar {
        background-color: var(--color-background);
        color: var(--color-black);
        padding-top: .25em;
        padding-bottom: .25em;
        padding-right: .5em;
        padding-left: .5em;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-sm);
        font-family: var(--font-primary);
        font-size: .6rem;
        font-weight: bold;
        text-align: center;
        margin: 0;
        opacity: 1;
      }

      .buttonsidebar.active {
        background: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-primary);
        font-weight: bold;
        opacity: 1;
      }


      #download-link {
        margin-top: 1em;
      }

      #download-link a {
        color: var(--color-primary-light);
      }

      /* Bottom container of sidebar */
      #bottom {
        margin-top: auto;
        padding-top: 1em;
        line-height: 1.5em;
        font-size: .8rem;
        font-family: var(--font-primary);
      }


      #date-last-updated {
        font-style: italic;
      }

      /* CHW Cards design */
      .chw-cards-container {
        display: flex;
        flex-direction: column;
        gap: .5em;
        margin: 1em 0;
      }

      .chw-card {
        background-color: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-sm);
        padding: .5em;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s ease;
        width: 100%;
      }

      .chw-card:hover {
        background-color: var(--color-primary-light);
        color: var(--color-background);
      }

      .chw-card-number {
        font-family: var(--font-display);
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: .2em;
      }

      .chw-card-number-not-available {
        font-family: var(--font-primary);
        font-style: italic;
        font-size: .6rem;
      }

      .chw-card-label {
        font-family: var(--font-primary);
        font-size: .6rem;
        font-weight: normal;
      }

      .chw-popups-container {
        margin-top: .2em;
      }

      .chw-popup {
        display: none;
        background-color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-sm);
        padding: .5em;
        margin-bottom: .5em;
        font-family: var(--font-primary);
        font-size: .6rem;
        width: 100%;
      }

      .chw-popup-title {
        font-weight: bold;
        margin-bottom: .3em;
        color: var(--color-primary-light);
      }

      .chw-popup-list {
        list-style-type: disc;
        margin-left: 1em;
        padding-left: 0;
      }

      .chw-popup-list li {
        margin-bottom: .2em;
      }

      /* Policy Status Card */
      .policy-status-card {
        background-color: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-sm);
        padding: .5em;
        margin: .5em 0;
        font-family: var(--font-primary);
        font-size: .6rem;
        width: 100%;
      }

      .policy-status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: .5em;
      }

      .policy-status-title {
        font-weight: bold;
        color: var(--color-background);
      }

      .policy-status-badge {
        padding: .2em .4em;
        border-radius: var(--radius-sm);
        font-weight: bold;
        font-size: .5rem;
        text-transform: uppercase;
      }

      .policy-status-badge.out-of-scope {
        background-color: var(--color-neutral);
        color: var(--color-background);
      }

      .policy-status-badge.data-not-available {
        background-color: var(--color-light-gray);
        color: var(--color-primary-light);
      }

      .policy-status-badge.expired,
      .policy-status-badge.expiring {
        background-color: var(--color-warning);
        color: var(--color-background);
      }

      .policy-status-badge.active {
        background-color: var(--color-secondary);
        color: var(--color-background);
      }

      .policy-status-content {
        font-size: .6rem;
      }

      .policy-status-line {
        margin-bottom: .1em;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .policy-status-label {
        font-weight: bold;
        flex-shrink: 0;
      }

      .policy-status-value {
        text-align: right;
        word-wrap: break-word;
        flex: 1;
        margin-left: 1em;
      }

      .policy-status-divider {
        height: 1px;
        background-color: rgba(244, 241, 235, 0.5);
        margin: .5em auto;
        width: 85%;
        display: block;
      }

      .policy-link {
        color: var(--color-background);
        text-decoration: none;
        font-weight: bold;
      }

      .policy-link:hover {
        text-decoration: underline;
      }

      /* Accreditation Section */
      .accreditation-section {
        background-color: transparent;
        border: none;
        border-radius: var(--radius-sm);
        margin: .3em 0;
        width: 100%;
      }

      .accreditation-section-header {
        background-color: transparent;
        border: none;
        border-radius: var(--radius-sm);
        padding: .5em;
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .accreditation-section-header:hover {
        background-color: rgba(79, 32, 73, 0.1);
      }

      .accreditation-section-title {
        font-family: var(--font-display);
        font-size: .6rem;
        color: var(--color-primary-light);
        text-transform: uppercase;
        font-weight: bold;
        line-height: 1.2;
      }

      .accreditation-section-arrow {
        color: var(--color-neutral);
        font-weight: bold;
        font-size: .8rem;
        margin-left: .5em;
        transition: transform 0.2s ease;
      }

      .accreditation-section.expanded .accreditation-section-arrow {
        transform: rotate(90deg);
      }

      .accreditation-section-content {
        padding: .5em;
        background-color: rgba(79, 32, 73, 0.05);
        border-radius: var(--radius-sm);
        margin-top: .2em;
      }

      .accreditation-section-text {
        font-family: var(--font-primary);
        font-size: .6rem;
        color: var(--color-primary-light);
      }

      /* Accreditation Subsections */
      .accreditation-subsection {
        display: flex;
        align-items: flex-start;
        margin-bottom: .8em;
        padding-left: .5em;
        border-left: 3px solid var(--color-primary);
      }

      .accreditation-subsection-content {
        flex: 1;
        margin-right: .5em;
      }

      .accreditation-subsection-title {
        font-family: var(--font-primary);
        font-size: .6rem;
        font-weight: bold;
        text-transform: uppercase;
        color: var(--color-primary-light);
        margin-bottom: .3em;
        line-height: 1.2;
      }

      .accreditation-subsection-description {
        font-family: var(--font-primary);
        font-size: .5rem;
        color: var(--color-primary-light);
        font-style: italic;
        line-height: 1.3;
      }

      .accreditation-subsection-indicator {
        display: flex;
        align-items: center;
        flex-shrink: 0;
        margin-left: .5em;
      }

      .indicator-circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: .3em;
        font-size: .5rem;
        font-weight: bold;
      }

      .indicator-circle.yes {
        background-color: var(--color-secondary);
        color: var(--color-light-gray);
      }

      .indicator-circle.no {
        background-color: var(--color-warning);
        color: var(--color-light-gray);
      }

      .indicator-text {
        font-family: var(--font-primary);
        font-size: .5rem;
        font-weight: bold;
        text-transform: uppercase;
        color: var(--color-light-gray);
      }

      .accreditation-subsection-source {
        font-family: var(--font-primary);
        font-size: .5rem;
        color: var(--color-primary-light);
        margin-top: .3em;
        line-height: 1.3;
        font-style: italic;
      }

      .accreditation-subsection-source a {
        color: var(--color-primary-light);
        text-decoration: underline;
      }

      .accreditation-subsection-source a:hover {
        color: var(--color-primary);
      }


      /* Button hover (definition) design */
      .buttondefcontainer {
        display: none;
      }

    }

    /* Laptop */
    @media screen and (min-width: 768px) {

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0px;
        padding: 0px;
        background-color: var(--color-background);
        height: 100%;
      }

      .container {
        display: grid;
        grid-template-columns: repeat(12, minmax(0, 1fr));
        grid-template-rows: 20vh 80vh;
        height: 100%;
      }

      /* Container for header elements */
      .header {
        grid-column: 1 / span 12;
        display: grid;
      }

      .header-section {
        grid-row: 1;
        display: grid;
        align-items: center;
      }

      /* Child containers within header */
      .left {
        grid-column: 1 / span 2;
      }

      .middle {
        grid-column: 3 / span 6;
      }

      .right {
        grid-column: 9 / span 3;
      }

      /* Define map and sidebar container */
      .content-section {
        grid-row: 2;
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        grid-column: 9 / span 4;
        background-color: var(--color-background);
        color: var(--color-primary-light);
        padding: 1em;
        border-top: solid 1.5px var(--color-primary-light);
        border-left: solid 1.5px var(--color-primary-light);
        overflow-y: auto;
        max-height: 100%;
      }

      /* "Submit additional country details" link design */
      .submitlink {
        text-align: center;
        background-color: var(--color-accent);
        font-family: var(--font-primary);
        text-align: center;
        vertical-align: middle;
        font-size: 1rem;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: var(--radius-lg);
        padding: 1em;
        margin: 1em;
      }

      #submitlink a {
        color: var(--color-background);
      }

      .right a:link {
        text-decoration: none;
      }

      .right a:visited {
        text-decoration: none;
      }

      /* Total accredited & salaried */
      #totaltext {
        color: var(--color-primary-light);
        font-family: var(--font-display);
        font-size: clamp(1.8rem, 1.046rem + 1.571vw, 2.46rem);
        overflow-wrap: normal;
        vertical-align: middle;
        margin-top: 0.3em;
        margin-bottom: 0.3em;
        margin-right: 0.3em;
        line-height: 1.1em;

      }

      #total-accredited-and-salaried {
        color: var(--color-background);
        font-family: var(--font-display);
        font-size: clamp(2rem, 1.2rem + 1.667vw, 2.7rem);
        text-align: center;
        vertical-align: middle;
        background-color: var(--color-secondary);
        margin: 0.3em;
        padding: 0.3em;
        border-radius: var(--radius-lg);
      }

      /* Map positioning */
      #map {
        grid-column: 1 / span 8;
        height: 100%;
      }

      /* Map overlays */
      .legend {
        position: absolute;
        bottom: 0;
        left: 0;
        background: #fff;
        margin-left: 1em;
        overflow: auto;
        border-radius: 4px;
        padding: .8em;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
      }

      #legend {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        line-height: 1.3em;
        margin-bottom: 2.5em;
      }

      .legend-key {
        display: inline-block;
        border-radius: 20%;
        width: 10px;
        height: 10px;
        margin-right: 5px;
      }

      .legenditems {
        display: inline-block;
      }

      h4 {
        margin-top: 5px;
        margin-bottom: 5px;
      }

      /* Popup design */
      .mapboxgl-popup-content {
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
      }

      /* Sidebar design */
      #country-name {
        font-size: clamp(1rem, 0.25rem + 2vw, 3rem);
        text-transform: uppercase;
        font-family: var(--font-display);
        line-height: 1.1em;
      }

      .out-of-scope-text {
        font-style: italic;
        font-family: var(--font-primary);
        font-size: clamp(0.6rem, 0.371rem + 0.476vw, 0.8rem);
        color: var(--color-primary-light);
        margin-bottom: 1em;
      }

      .country-details * {
        font-family: var(--font-primary);
        margin-bottom: .5em;
        line-height: 1.3em;
        overflow-wrap: normal;
        font-size: clamp(0.6rem, 0.371rem + 0.476vw, 0.8rem);
      }

      #download-link {
        margin-top: 1em;
      }

      #download-link a {
        color: var(--color-primary-light);
      }

      /* Button design (sidebar buttons) */
      .buttonsidebar {
        background-color: var(--color-background);
        color: var(--color-black);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        white-space: normal;
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        font-weight: bold;
        text-align: center;
        padding-right: 1em;
        padding-left: 1em;
        padding-top: 1em;
        padding-bottom: 1em;
        opacity: 1;
      }

      buttonsidebar:hover {
        background: #4F2049;
        color: var(--color-background);
        border: 1px solid var(--color-primary);
        font-weight: bold;
        opacity: 1;
      }

      /* Bottom container of sidebar */
      .bottom {
        margin-top: auto;
        padding-top: 1em;
        line-height: 1.3em;
        font-family: var(--font-primary);
        font-size: clamp(0.6rem, 0.371rem + 0.476vw, 0.8rem);
      }


      #date-last-updated {
        font-style: italic;
      }

      /* CHW Cards design */
      .chw-cards-container {
        display: flex;
        flex-direction: row;
        gap: .5em;
        margin: 1em 0;
        flex-wrap: wrap;
      }

      .chw-card {
        background-color: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        padding: .8em;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s ease;
        flex: 1;
        min-width: 0;
      }

      .chw-card:hover {
        background-color: var(--color-primary-light);
        color: var(--color-background);
      }

      .chw-card-number {
        font-family: var(--font-display);
        font-size: clamp(1rem, 0.8rem + 0.5vw, 1.5rem);
        font-weight: bold;
        margin-bottom: .3em;
      }

      .chw-card-number-not-available {
        font-family: var(--font-primary);
        font-style: italic;
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
      }

      .chw-card-label {
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        font-weight: normal;
      }

      .chw-popups-container {
        margin-top: .2em;
      }

      .chw-popup {
        display: none;
        background-color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        padding: .8em;
        margin-bottom: .5em;
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        width: 100%;
      }

      .chw-popup-title {
        font-weight: bold;
        margin-bottom: .5em;
        color: var(--color-primary-light);
      }

      .chw-popup-list {
        list-style-type: disc;
        margin-left: 1em;
        padding-left: 0;
      }

      .chw-popup-list li {
        margin-bottom: .3em;
      }


      /* Map button design */
      .button {
        background-color: var(--color-background);
        color: var(--color-black);
        padding: 10px;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        font-weight: bold;
        text-align: center;
        padding-right: 1em;
        padding-left: 1em;
        padding-top: .5em;
        padding-bottom: .5em;
        margin: 0;
        opacity: 0.8;
      }

      .button.active {
        background: #4F2049;
        color: var(--color-background);
        border: 1px solid var(--color-primary);
        font-weight: bold;
        opacity: 1;
      }

      /* Policy Status Card */
      .policy-status-card {
        background-color: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        padding: .8em;
        margin: .5em 0;
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        width: 100%;
      }

      .policy-status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: .5em;
      }

      .policy-status-title {
        font-weight: bold;
        color: var(--color-background);
      }

      .policy-status-badge {
        padding: .3em .6em;
        border-radius: var(--radius-md);
        font-weight: bold;
        font-size: clamp(0.4rem, 0.2875rem + .4vw, 0.8rem);
        text-transform: uppercase;
      }

      .policy-status-badge.out-of-scope {
        background-color: var(--color-neutral);
        color: var(--color-background);
      }

      .policy-status-badge.data-not-available {
        background-color: var(--color-light-gray);
        color: var(--color-primary-light);
      }

      .policy-status-badge.expired,
      .policy-status-badge.expiring {
        background-color: var(--color-warning);
        color: var(--color-background);
      }

      .policy-status-badge.active {
        background-color: var(--color-secondary);
        color: var(--color-background);
      }

      .policy-status-content {
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
      }

      .policy-status-line {
        margin-bottom: .1em;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .policy-status-label {
        font-weight: bold;
        flex-shrink: 0;
      }

      .policy-status-value {
        text-align: right;
        word-wrap: break-word;
        flex: 1;
        margin-left: 1em;
      }

      .policy-status-divider {
        height: 1px;
        background-color: rgba(244, 241, 235, 0.5);
        margin: .5em auto;
        width: 85%;
        display: block;
      }

      .policy-link {
        color: var(--color-background);
        text-decoration: none;
        font-weight: bold;
      }

      .policy-link:hover {
        text-decoration: underline;
      }

      /* Accreditation Section */
      .accreditation-section {
        background-color: transparent;
        border: none;
        border-radius: var(--radius-md);
        margin: .3em 0;
        width: 100%;
      }

      .accreditation-section-header {
        background-color: transparent;
        border: none;
        border-radius: var(--radius-md);
        padding: .8em;
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .accreditation-section-header:hover {
        background-color: rgba(79, 32, 73, 0.1);
      }

      .accreditation-section-title {
        font-family: var(--font-display);
        font-size: clamp(0.5rem, 0.3875rem + .4vw, 0.9rem);
        color: var(--color-primary-light);
        text-transform: uppercase;
        font-weight: bold;
        line-height: 1.2;
      }

      .accreditation-section-arrow {
        color: var(--color-neutral);
        font-weight: bold;
        font-size: .8rem;
        margin-left: .5em;
        transition: transform 0.2s ease;
      }

      .accreditation-section.expanded .accreditation-section-arrow {
        transform: rotate(90deg);
      }

      .accreditation-section-content {
        padding: .8em;
        background-color: rgba(79, 32, 73, 0.05);
        border-radius: var(--radius-md);
        margin-top: .2em;
      }

      .accreditation-section-text {
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .4vw, 0.9rem);
        color: var(--color-primary-light);
      }

      /* Accreditation Subsections */
      .accreditation-subsection {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1em;
        padding-left: .8em;
        border-left: 3px solid var(--color-primary);
      }

      .accreditation-subsection-content {
        flex: 1;
        margin-right: .8em;
      }

      .accreditation-subsection-title {
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .4vw, 0.9rem);
        font-weight: bold;
        text-transform: uppercase;
        color: var(--color-primary-light);
        margin-bottom: .4em;
        line-height: 1.2;
      }

      .accreditation-subsection-description {
        font-family: var(--font-primary);
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        color: var(--color-primary-light);
        font-style: italic;
        line-height: 1.3;
      }

      .accreditation-subsection-indicator {
        display: flex;
        align-items: center;
        flex-shrink: 0;
        margin-left: .8em;
      }

      .indicator-circle {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: .4em;
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        font-weight: bold;
      }

      .indicator-circle.yes {
        background-color: var(--color-secondary);
        color: var(--color-light-gray);
      }

      .indicator-circle.no {
        background-color: var(--color-warning);
        color: var(--color-light-gray);
      }

      .indicator-text {
        font-family: var(--font-primary);
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        font-weight: bold;
        text-transform: uppercase;
        color: var(--color-light-gray);
      }

      .accreditation-subsection-source {
        font-family: var(--font-primary);
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        color: var(--color-primary-light);
        margin-top: .4em;
        line-height: 1.3;
        font-style: italic;
      }

      .accreditation-subsection-source a {
        color: var(--color-primary-light);
        text-decoration: underline;
      }

      .accreditation-subsection-source a:hover {
        color: var(--color-primary);
      }

      .buttoncontainer {
        position: absolute;
        top: 22%;
        left: 0;
        margin-left: 10px;
      }

      /* Search bar design */
      .searchcontainer {
        position: absolute;
        top: 28%;
        left: 0;
        margin-left: 10px;
        width: 300px;
        z-index: 1000;
      }

      .search-input {
        width: 100%;
        padding: .8em;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        background-color: var(--color-white);
        /* background-color: #F4F1EB; */
        color: var(--color-black);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 5px rgba(79, 32, 73, 0.3);
      }

      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: #FFF;
        border: 1px solid var(--color-black);
        border-top: none;
        border-radius: 0 0 5px 5px;
        max-height: 250px;
        overflow-y: auto;
        display: none;
        z-index: 1001;
      }

      .search-result-item {
        padding: .8em;
        cursor: pointer;
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        border-bottom: 1px solid var(--color-light-gray);
      }

      .search-result-item:hover {
        background-color: var(--color-primary);
        color: var(--color-background);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      button:hover {
        background: #4F2049;
        color: var(--color-background);
        font-weight: bold;
        border: 1px solid var(--color-primary);
      }

      /* Button hover (definition) design */
      .buttondefcontainer {
        position: absolute;
        top: 28%;
        left: 0;
        margin-left: 10px;
        width: 30%;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        font-size: .8rem;
      }

      .accredited-chws-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

      .salaried-chws-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

      .accredited-and-salaried-chws-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

      .policy-status-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

    }

    /* Desktop */
    @media screen and (min-width: 1280px) and (min-height: 570px) {

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0px;
        padding: 0px;
        background-color: var(--color-background);
        height: 100%;
      }

      .container {
        display: grid;
        grid-template-columns: repeat(12, minmax(0, 1fr));
        grid-template-rows: 20vh 80vh;
        height: 100%;
      }

      /* Container for header elements */
      .header {
        grid-column: 1 / span 12;
        display: grid;
        align-items: center;
      }

      .header-section {
        grid-row: 1;
      }

      /* Child containers within header */
      .left {
        grid-column: 1 / span 2;
      }

      .middle {
        grid-column: 3 / span 6;
      }

      .right {
        grid-column: 9 / span 3;
      }

      /* Define map and sidebar container */
      .content-section {
        grid-row: 2;
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        grid-column: 9 / span 4;
        background-color: var(--color-background);
        color: var(--color-primary-light);
        padding: 1em;
        border-top: solid 1.5px var(--color-primary-light);
        border-left: solid 1.5px var(--color-primary-light);
        overflow-y: auto;
        max-height: 100%;
      }

      /* "Submit additional country details" link design */
      .submitlink {
        text-align: center;
        background-color: var(--color-accent);
        font-family: var(--font-primary);
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
        font-size: clamp(0.6rem, 0.4425rem + .7vw, 1.3rem);
        text-transform: uppercase;
        border-radius: var(--radius-lg);
        padding: 1em;
        margin: 1em;
      }

      #submitlink a {
        color: var(--color-background);
      }

      .right a:link {
        text-decoration: none;
      }

      .right a:visited {
        text-decoration: none;
      }

      /* Total accredited & salaried */
      #totaltext {
        color: var(--color-primary-light);
        font-family: var(--font-display);
        font-size: clamp(2.4rem, -8.8rem + 14vw, 3.8rem);
        vertical-align: middle;
        margin-top: 0.3em;
        margin-bottom: 0.3em;
        margin-right: 0.3em;
        line-height: 1.1em;

      }

      #total-accredited-and-salaried {
        color: var(--color-background);
        font-family: var(--font-display);
        font-size: clamp(2.4rem, -10.4rem + 16vw, 4rem);
        text-align: center;
        vertical-align: middle;
        background-color: var(--color-secondary);
        margin: 0.3em;
        padding: 0.3em;
        border-radius: var(--radius-lg);
      }

      /* Map positioning */
      #map {
        grid-column: 1 / span 8;
        height: 100%;
      }

      /* Map overlays */
      .legend {
        position: absolute;
        bottom: 0;
        left: 0;
        background: #fff;
        margin-left: 1em;
        overflow: auto;
        border-radius: 4px;
        padding: .8em;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
      }

      #legend {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        line-height: 1.3em;
        margin-bottom: 2.5em;
      }

      .legend-key {
        display: inline-block;
        border-radius: 20%;
        width: 10px;
        height: 10px;
        margin-right: 5px;
      }

      .legenditems {
        display: inline-block;
      }

      h4 {
        margin-top: 5px;
        margin-bottom: 5px;
      }

      /* Popup design */
      .mapboxgl-popup-content {
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
      }

      /* Sidebar design */
      #country-name {
        font-size: clamp(1rem, 0.25rem + 2vw, 3rem);
        text-transform: uppercase;
        font-family: var(--font-display);
        line-height: 1.1em;
      }

      .out-of-scope-text {
        font-style: italic;
        font-family: var(--font-primary);
        font-size: clamp(.7rem, 0.6325rem + .3vw, 1rem);
        color: var(--color-primary-light);
        margin-bottom: 1em;
      }

      .country-details * {
        font-family: var(--font-primary);
        margin-bottom: 0.8em;
        line-height: 1.5em;
        overflow-wrap: normal;
        font-size: clamp(.7rem, 0.6325rem + .3vw, 1rem)
      }

      #download-link {
        margin-top: 1em;
      }

      #download-link a {
        color: var(--color-primary-light);
      }

      /* Button design (sidebar buttons) */
      .buttonsidebar {
        background-color: var(--color-background);
        color: var(--color-black);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        font-weight: bold;
        text-align: center;
        padding-right: 1em;
        padding-left: 1em;
        padding-top: 1em;
        padding-bottom: 1em;
        opacity: 1;
      }

      buttonsidebar:hover {
        background: #4F2049;
        color: var(--color-background);
        border: 1px solid var(--color-primary);
        font-weight: bold;
        opacity: 1;
      }

      /* Bottom container of sidebar */
      .bottom {
        margin-top: auto;
        padding-top: 1em;
        line-height: 1.3em;
        font-family: var(--font-primary);
        font-size: clamp(.7rem, 0.655rem + .2vw, 1rem);
      }


      #date-last-updated {
        font-style: italic;
      }

      /* CHW Cards design */
      .chw-cards-container {
        display: flex;
        flex-direction: row;
        gap: .5em;
        margin: 1em 0;
        flex-wrap: wrap;
      }

      .chw-card {
        background-color: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        padding: 1em;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s ease;
        flex: 1;
        min-width: 0;
      }

      .chw-card:hover {
        background-color: var(--color-primary-light);
        color: var(--color-background);
      }

      .chw-card-number {
        font-family: var(--font-display);
        font-size: clamp(1.2rem, 1rem + 0.5vw, 1.8rem);
        font-weight: bold;
        margin-bottom: .3em;
      }

      .chw-card-number-not-available {
        font-family: var(--font-primary);
        font-style: italic;
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
      }

      .chw-card-label {
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        font-weight: normal;
      }

      .chw-popups-container {
        margin-top: .2em;
      }

      .chw-popup {
        display: none;
        background-color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        padding: 1em;
        margin-bottom: .5em;
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        width: 100%;
      }

      .chw-popup-title {
        font-weight: bold;
        margin-bottom: .5em;
        color: var(--color-primary-light);
      }

      .chw-popup-list {
        list-style-type: disc;
        margin-left: 1em;
        padding-left: 0;
      }

      .chw-popup-list li {
        margin-bottom: .3em;
      }


      /* Map button design */
      .button {
        background-color: var(--color-background);
        color: var(--color-black);
        padding: 10px;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        font-weight: bold;
        text-align: center;
        padding-right: 1em;
        padding-left: 1em;
        padding-top: .5em;
        padding-bottom: .5em;
        margin: 0;
        opacity: 0.8;
      }

      .button.active {
        background: #4F2049;
        color: var(--color-background);
        border: 1px solid var(--color-primary);
        font-weight: bold;
        opacity: 1;
      }

      /* Policy Status Card */
      .policy-status-card {
        background-color: var(--color-primary);
        color: var(--color-background);
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        padding: 1em;
        margin: .5em 0;
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        width: 100%;
      }

      .policy-status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: .5em;
      }

      .policy-status-title {
        font-weight: bold;
        color: var(--color-background);
      }

      .policy-status-badge {
        padding: .3em .6em;
        border-radius: var(--radius-md);
        font-weight: bold;
        font-size: clamp(0.4rem, 0.2875rem + .4vw, 0.8rem);
        text-transform: uppercase;
      }

      .policy-status-badge.out-of-scope {
        background-color: var(--color-neutral);
        color: var(--color-background);
      }

      .policy-status-badge.data-not-available {
        background-color: var(--color-light-gray);
        color: var(--color-primary-light);
      }

      .policy-status-badge.expired,
      .policy-status-badge.expiring {
        background-color: var(--color-warning);
        color: var(--color-background);
      }

      .policy-status-badge.active {
        background-color: var(--color-secondary);
        color: var(--color-background);
      }

      .policy-status-content {
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
      }

      .policy-status-line {
        margin-bottom: .1em;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .policy-status-label {
        font-weight: bold;
        flex-shrink: 0;
      }

      .policy-status-value {
        text-align: right;
        word-wrap: break-word;
        flex: 1;
        margin-left: 1em;
      }

      .policy-status-divider {
        height: 1px;
        background-color: rgba(244, 241, 235, 0.5);
        margin: .5em auto;
        width: 85%;
        display: block;
      }

      .policy-link {
        color: var(--color-background);
        text-decoration: none;
        font-weight: bold;
      }

      .policy-link:hover {
        text-decoration: underline;
      }

      /* Accreditation Section */
      .accreditation-section {
        background-color: transparent;
        border: none;
        border-radius: var(--radius-md);
        margin: .3em 0;
        width: 100%;
      }

      .accreditation-section-header {
        background-color: transparent;
        border: none;
        border-radius: var(--radius-md);
        padding: 1em;
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .accreditation-section-header:hover {
        background-color: rgba(79, 32, 73, 0.1);
      }

      .accreditation-section-title {
        font-family: var(--font-display);
        font-size: clamp(0.5rem, 0.3875rem + .4vw, 0.9rem);
        color: var(--color-primary-light);
        text-transform: uppercase;
        font-weight: bold;
        line-height: 1.2;
      }

      .accreditation-section-arrow {
        color: var(--color-neutral);
        font-weight: bold;
        font-size: .8rem;
        margin-left: .5em;
        transition: transform 0.2s ease;
      }

      .accreditation-section.expanded .accreditation-section-arrow {
        transform: rotate(90deg);
      }

      .accreditation-section-content {
        padding: 1em;
        background-color: rgba(79, 32, 73, 0.05);
        border-radius: var(--radius-md);
        margin-top: .2em;
      }

      .accreditation-section-text {
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .4vw, 0.9rem);
        color: var(--color-primary-light);
      }

      /* Accreditation Subsections */
      .accreditation-subsection {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1em;
        padding-left: .8em;
        border-left: 3px solid var(--color-primary);
      }

      .accreditation-subsection-content {
        flex: 1;
        margin-right: .8em;
      }

      .accreditation-subsection-title {
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .4vw, 0.9rem);
        font-weight: bold;
        text-transform: uppercase;
        color: var(--color-primary-light);
        margin-bottom: .4em;
        line-height: 1.2;
      }

      .accreditation-subsection-description {
        font-family: var(--font-primary);
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        color: var(--color-primary-light);
        font-style: italic;
        line-height: 1.3;
      }

      .accreditation-subsection-indicator {
        display: flex;
        align-items: center;
        flex-shrink: 0;
        margin-left: .8em;
      }

      .indicator-circle {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: .4em;
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        font-weight: bold;
      }

      .indicator-circle.yes {
        background-color: var(--color-secondary);
        color: var(--color-light-gray);
      }

      .indicator-circle.no {
        background-color: var(--color-warning);
        color: var(--color-light-gray);
      }

      .indicator-text {
        font-family: var(--font-primary);
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        font-weight: bold;
        text-transform: uppercase;
        color: var(--color-light-gray);
      }

      .accreditation-subsection-source {
        font-family: var(--font-primary);
        font-size: clamp(0.4rem, 0.2875rem + .3vw, 0.7rem);
        color: var(--color-primary-light);
        margin-top: .4em;
        line-height: 1.3;
        font-style: italic;
      }

      .accreditation-subsection-source a {
        color: var(--color-primary-light);
        text-decoration: underline;
      }

      .accreditation-subsection-source a:hover {
        color: var(--color-primary);
      }

      .buttoncontainer {
        position: absolute;
        top: 20%;
        left: 0;
        margin-left: 10px;
      }

      /* Search bar design */
      .searchcontainer {
        position: absolute;
        top: 26%;
        left: 0;
        margin-left: 10px;
        width: 350px;
        z-index: 1000;
      }

      .search-input {
        width: 100%;
        padding: 1em;
        border: 1px solid var(--color-black);
        border-radius: var(--radius-md);
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        background-color: var(--color-background);
        color: var(--color-black);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 5px rgba(79, 32, 73, 0.3);
      }

      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: var(--color-background);
        border: 1px solid var(--color-black);
        border-top: none;
        border-radius: 0 0 5px 5px;
        max-height: 300px;
        overflow-y: auto;
        display: none;
        z-index: 1001;
      }

      .search-result-item {
        padding: 1em;
        cursor: pointer;
        font-family: var(--font-primary);
        font-size: clamp(0.5rem, 0.3875rem + .5vw, 1rem);
        border-bottom: 1px solid var(--color-light-gray);
      }

      .search-result-item:hover {
        background-color: var(--color-primary);
        color: var(--color-background);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      button:hover {
        background: #4F2049;
        color: var(--color-background);
        font-weight: bold;
        border: 1px solid var(--color-primary);
      }

      /* Button hover (definition) design */
      .buttondefcontainer {
        position: absolute;
        top: 25%;
        left: 0;
        margin-left: 10px;
        width: 30%;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        font-size: .8rem;
      }

      .accredited-chws-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

      .salaried-chws-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

      .accredited-and-salaried-chws-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

      .policy-status-button-def {
        display: none;
        position: relative;
        top: 0;
        left: 0;
        font-family: 'Helvetica Neue', 'Arial Narrow', Sans-serif;
        opacity: 0.8;
        background-color: var(--color-black);
        color: var(--color-background);
        padding: 10px;
      }

    }

  </style>

</head>

<body>

  <!-- Page congainer -->
  <div class="container">

    <!-- Header container, with title, subtitle, proCHW total, and accompanying text -->
    <div class="header">

      <!-- Left side of header -->
      <div class="header-section left">
        <div id="total-accredited-and-salaried"></div>
      </div>

      <!-- Middle of header -->
      <div id="totaltext" class="header-section middle">COUNTRIES CURRENTLY HAVE ONE OR MORE CHW GROUPS WHO ARE ACCREDITED AND SALARIED</div>

      <!-- Right side of header -->
      <div class="header-section right">
        <div id="submitlink" class="submitlink">
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSeQfSZ9YG6ecSnWiBoUshtKBRGXVyYPt4Hfo_nx4ugBFkaEww/viewform"
            target="_blank">
            SUBMIT ADDITIONAL COUNTRY DETAILS HERE
          </a>
        </div>
      </div>

    </div>

    <!-- Map container with map inside -->
    <div id="map" class="content-section map"></div>

    <!-- Map overlays, including legend and buttons -->
    <div id="legend" class="legend">
      <h4 id="legend-title"></h4>
      <div id="legenditems"></div>
    </div>

    <!-- Button container -->
    <div id="buttoncontainer" class="buttoncontainer">
      <button type="button" id="accredited-chws-button" class="button">ACCREDITED CHWS</button>
      <button type="button" id="salaried-chws-button" class="button">SALARIED CHWS</button>
      <button type="button" id="accredited-and-salaried-chws-button" class="button">ACCREDITED & SALARIED CHWS</button>
      <button type="button" id="policy-status-button" class="button">POLICY STATUS</button>
    </div>

    <!-- Search bar container -->
    <div id="searchcontainer" class="searchcontainer">
      <input type="text" id="country-search" placeholder="Search for a country..." class="search-input">
      <div id="search-results" class="search-results"></div>
    </div>

    <!-- Button definitions -->
    <div class="buttondefcontainer">
      <div class="accredited-and-salaried-chws-button-def">For purposes of
        this dashboard, we focus on two of the eight best practices that are indicative of formal,
        fulfilling, and dignified labor conditions and for which sufficient data exists in policy
        documents: accreditation and compensation.
      </div>
      <div class="salaried-chws-button-def">Does the policy document provide for CHWs to be compensated
        through government wage bills? (Policies that stipulate CHW remuneration via performance-based
        incentives, stipends, and/or non-financial incentives like gumboots, t-shirts, soap, and
        batteries were coded as No.)
      </div>
      <div class="accredited-chws-button-def">Does the country policy document explicitly recognize
        roles, qualifications, and competencies for CHWs?
      </div>
      <div class="policy-status-button-def">What is the status of the country's policy? (Policy expiration date details are updated every 6 months). 
      </div>
    </div>

    <!-- Sidebar -->
    <div class="content-section sidebar">

      <!-- Country details section within sidebar -->
      <div id='country-details' class='country-details'>

        <div id="country-name">Select a country to see details</div>
        <div id="out-of-scope-message" class="out-of-scope-text" style="display: none;">
          Out of Scope
        </div>
        
        <!-- CHW Cards Container -->
        <div id="chw-cards-container" class="chw-cards-container" style="display: none;">
          <!-- Total CHW Groups Card -->
          <div id="total-chw-groups-card" class="chw-card">
            <div id="total-chw-groups-number" class="chw-card-number"></div>
            <div class="chw-card-label">Total CHW Groups</div>
          </div>
          
          <!-- Salaried & Accredited Card -->
          <div id="salaried-accredited-card" class="chw-card">
            <div id="salaried-accredited-number" class="chw-card-number"></div>
            <div class="chw-card-label">Salaried & Accredited</div>
          </div>
          
          <!-- CHW Associations Card -->
          <div id="chw-associations-card" class="chw-card">
            <div id="chw-associations-number" class="chw-card-number"></div>
            <div class="chw-card-label">CHW Associations</div>
          </div>
        </div>
        
        <!-- CHW Popups Container -->
        <div id="chw-popups-container" class="chw-popups-container">
          <div id="total-chw-groups-popup" class="chw-popup">
            <div class="chw-popup-title">All CHW Group(s):</div>
            <ul id="total-chw-groups-list" class="chw-popup-list"></ul>
          </div>
          
          <div id="salaried-accredited-popup" class="chw-popup">
            <div class="chw-popup-title">Salaried & Accredited Group(s):</div>
            <ul id="salaried-accredited-list" class="chw-popup-list"></ul>
          </div>
          
          <div id="chw-associations-popup" class="chw-popup">
            <div class="chw-popup-title">CHW Association(s):</div>
            <ul id="chw-associations-list" class="chw-popup-list"></ul>
          </div>
        </div>
        
        <!-- Policy Status Card -->
        <div id="policy-status-card" class="policy-status-card" style="display: none;">
          <div class="policy-status-header">
            <div class="policy-status-title">Policy Status</div>
            <div id="policy-status-badge" class="policy-status-badge"></div>
          </div>
          <div class="policy-status-content">
            <div class="policy-status-line">
              <span class="policy-status-label">Implementation</span>
              <span id="policy-implementation-text" class="policy-status-value"></span>
            </div>
            <div class="policy-status-line">
              <span class="policy-status-label">Policy Years</span>
              <span id="policy-years-text" class="policy-status-value"></span>
            </div>
            <div class="policy-status-divider"></div>
            <div id="policy-link-container" class="policy-link-container">
              <a id="policy-link" href="#" target="_blank" class="policy-link">View policy document </a>
            </div>
          </div>
        </div>
        
        <!-- Single Clickable Section -->
        <div id="accreditation-section" class="accreditation-section" style="display: none;">
          <div class="accreditation-section-header">
            <div class="accreditation-section-title">ACCREDITATION, SALARY, SUPERVISION, SKILLS, & SUPPLIES</div>
            <div class="accreditation-section-arrow">></div>
          </div>
          <div class="accreditation-section-content" style="display: none;">
            <!-- Accreditation Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">ACCREDITATION</div>
                <div class="accreditation-subsection-description" id="accreditation-description"></div>
                <div class="accreditation-subsection-source" id="accreditation-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="accreditation-indicator"></div>
                <div class="indicator-text" id="accreditation-text"></div>
              </div>
            </div>
            
            <!-- Salary Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">SALARY</div>
                <div class="accreditation-subsection-description" id="salary-description"></div>
                <div class="accreditation-subsection-source" id="salary-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="salary-indicator"></div>
                <div class="indicator-text" id="salary-text"></div>
              </div>
            </div>
            
            <!-- Supervision Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">SUPERVISION</div>
                <div class="accreditation-subsection-description" id="supervision-description"></div>
                <div class="accreditation-subsection-source" id="supervision-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="supervision-indicator"></div>
                <div class="indicator-text" id="supervision-text"></div>
              </div>
            </div>
            
            <!-- Skills Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">SKILLS</div>
                <div class="accreditation-subsection-description" id="skills-description"></div>
                <div class="accreditation-subsection-source" id="skills-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="skills-indicator"></div>
                <div class="indicator-text" id="skills-text"></div>
              </div>
            </div>
            
            <!-- Supplies Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">SUPPLIES</div>
                <div class="accreditation-subsection-description" id="supplies-description"></div>
                <div class="accreditation-subsection-source" id="supplies-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="supplies-indicator"></div>
                <div class="indicator-text" id="supplies-text"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Policy Implementation Section -->
        <div id="policy-implementation-section" class="accreditation-section" style="display: none;">
          <div class="accreditation-section-header">
            <div class="accreditation-section-title">POLICY IMPLEMENTATION</div>
            <div class="accreditation-section-arrow">></div>
          </div>
          <div class="accreditation-section-content" style="display: none;">
            <!-- Domestic Financing Commitment Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">DOMESTIC FINANCING COMMITMENT</div>
                <div class="accreditation-subsection-description" id="domestic-financing-commitment-description"></div>
                <div class="accreditation-subsection-source" id="domestic-financing-commitment-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="domestic-financing-commitment-indicator"></div>
                <div class="indicator-text" id="domestic-financing-commitment-text"></div>
              </div>
            </div>
            
            <!-- CHW Budget Line Item Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">CHW BUDGET LINE ITEM</div>
                <div class="accreditation-subsection-description" id="chw-budget-line-item-description"></div>
                <div class="accreditation-subsection-source" id="chw-budget-line-item-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="chw-budget-line-item-indicator"></div>
                <div class="indicator-text" id="chw-budget-line-item-text"></div>
              </div>
            </div>
            
            <!-- Data Systems / Feedback Loops Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">DATA SYSTEMS / FEEDBACK LOOPS</div>
                <div class="accreditation-subsection-description" id="data-systems-description"></div>
                <div class="accreditation-subsection-source" id="data-systems-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="data-systems-indicator"></div>
                <div class="indicator-text" id="data-systems-text"></div>
              </div>
            </div>
            
            <!-- MERL / M&E Framework Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">MERL / M&E FRAMEWORK</div>
                <div class="accreditation-subsection-description" id="merl-description"></div>
                <div class="accreditation-subsection-source" id="merl-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="merl-indicator"></div>
                <div class="indicator-text" id="merl-text"></div>
              </div>
            </div>
            
            <!-- CHW Registry Subsection -->
            <div class="accreditation-subsection">
              <div class="accreditation-subsection-content">
                <div class="accreditation-subsection-title">CHW REGISTRY</div>
                <div class="accreditation-subsection-description" id="chw-registry-description"></div>
                <div class="accreditation-subsection-source" id="chw-registry-source"></div>
              </div>
              <div class="accreditation-subsection-indicator">
                <div class="indicator-circle" id="chw-registry-indicator"></div>
                <div class="indicator-text" id="chw-registry-text"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Policy Timeline Section -->
        <div id="policy-timeline-section" class="accreditation-section" style="display: none;">
          <div class="accreditation-section-header">
            <div class="accreditation-section-title">POLICY TIMELINE</div>
            <div class="accreditation-section-arrow">></div>
          </div>
          <div class="accreditation-section-content" style="display: none;">
            <div class="accreditation-section-text">test</div>
          </div>
        </div>
        
        <!-- Bottom part of the sidebar -->
      <div id="bottom" class="bottom">

        <!-- Date last updated -->
        <div id="date-last-updated"></div>

      </div>

    </div>

  </div>

</body>

<script>

  // Initialize data
  let csvData = false

  // Basemap info
  mapboxgl.accessToken = 'pk.eyJ1IjoiY2hpY3BvbGljeWRhc2hib2FyZCIsImEiOiJjbGV5M3ZncXIwam96M3FuMGU4b3puMDVlIn0.aIXbEvRX7bYtEjBE2mmLTg';
  const map = new mapboxgl.Map({
    container: 'map', // container ID
    style: 'mapbox://styles/chicpolicydashboard/clf8f14r6000801qfp24pfnf2', // style URL
    center: [-3.0, -5.0], // starting position [lng, lat]
    zoom: 2, // starting zoom
  });

  // Create function to build a legend
  function buildLegend(legendColors, legendValues) {
    // First empty legend items
    const item = $('#legenditems')
    item.empty()
    legendValues.forEach((legendValue, i) => {
      const color = legendColors[i];
      const key = document.createElement('span')
      key.className = 'legend-key';
      key.style.backgroundColor = color

      const value = document.createElement('span');
      value.innerHTML = `${legendValue}`;
      item.append(key);
      item.append(value);
      item.append(document.createElement("br"));
    })
  }

  // Create function to define how colors are added to map and to build the legend
  function setColorsToMap(indicatorName) {

    // Initialize arrays for the map colors, the legend colors, and the legend values
    var caseExpression = []

    // If indicator is salaried_accredited_cat:
    if (indicatorName == "salaried_accredited_cat") {

      // Initialize arrays for all possible values of this indicator
      let bothArray = []
      let oneArray = []
      let neitherArray = []
      let naArray = []

      // Push ISO codes from csv data to arrays based on values
      csvData.forEach((row) => {
        if (row[indicatorName] == "Both") {
          bothArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Only paid or only accredited") {
          oneArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Neither") {
          neitherArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Data not available") {
          naArray.push(row.ISO_A3)
        }
      })

      // Set Mapbox colors based on arrays
      var caseExpression = [
        'case',
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", bothArray]], "#9272d9",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", oneArray]], "#20bdc5",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", neitherArray]], "#F36744",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", naArray]], "#999999",
        "#dbdbdb"
      ]

      // Set legend title, colors and values manually
      $('#legend-title').text("Is at least one CHW group salaried & accredited?")
      const legendColors = ["#9272d9", "#20bdc5", "#F36744", "#999999", "#dbdbdb"]
      const legendValues = ["Both", "Only salaried or only accredited", "Neither", "Data not available", "Out of scope"]

      // Now build legend
      buildLegend(legendColors, legendValues)

    }

    // Else if indicator is at_least_1_accredited:
    if (indicatorName == "at_least_1_accredited") {

      // Initialize arrays for all possible values of this indicator
      let yArray = []
      let nArray = []
      let naArray = []

      // Push ISO codes from csv data to arrays based on values
      csvData.forEach((row) => {
        if (row[indicatorName] == "Yes") {
          yArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "No") {
          nArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Data not available") {
          naArray.push(row.ISO_A3)
        }
      })

      // Set Mapbox colors based on arrays
      var caseExpression = [
        'case',
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", yArray]], "#9272d9",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", nArray]], "#F36744",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", naArray]], "#999999",
        "#dbdbdb"
      ]

      // Set legend title, colors and values manually
      $('#legend-title').text("Is at least one CHW group accredited?")
      var legendColors = ["#9272d9", "#F36744", "#999999", "#dbdbdb"]
      var legendValues = ["Yes", "No", "Data not available", "Out of scope"]

      // Now build legend
      buildLegend(legendColors, legendValues)

    }

    // Else if indicator is at_least_1_salaried:
    if (indicatorName == "at_least_1_salaried") {

      // Initialize arrays for all possible values of this indicator
      let yArray = []
      let nArray = []
      let naArray = []

      // Push ISO codes from csv data to arrays based on values
      csvData.forEach((row) => {
        if (row[indicatorName] == "Yes") {
          yArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "No") {
          nArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Data not available") {
          naArray.push(row.ISO_A3)
        }
      })

      // Set Mapbox colors based on arrays
      var caseExpression = [
        'case',
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", yArray]], "#9272d9",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", nArray]], "#F36744",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", naArray]], "#999999",
        "#dbdbdb"
      ]

      // Set legend title, colors and values manually
      $('#legend-title').text("Is at least one CHW group salaried?")
      var legendColors = ["#9272d9", "#F36744", "#999999", "#dbdbdb"]
      var legendValues = ["Yes", "No", "Data not available", "Out of scope"]

      // Now build legend
      buildLegend(legendColors, legendValues)

    }

    // Else if indicator is policy_status:
    if (indicatorName == "policy_status") {

      // Initialize arrays for all possible values of this indicator
      let activeArray = []
      let expiringArray = []
      let expiredArray = []
      let naArray = []

      // Push ISO codes from csv data to arrays based on values
      csvData.forEach((row) => {
        if (row[indicatorName] == "Active") {
          activeArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Expiring within 18 months") {
          expiringArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Expired") {
          expiredArray.push(row.ISO_A3)
        }
        if (row[indicatorName] == "Data not available") {
          naArray.push(row.ISO_A3)
        }
      })

      // Set Mapbox colors based on arrays
      var caseExpression = [
        'case',
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", activeArray]], "#9272d9",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", expiringArray]], "#20bdc5",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", expiredArray]], "#F36744",
        ["in", ["get", "iso_3166_1_alpha_3"], ["literal", naArray]], "#999999",
        "#dbdbdb"
      ]

      // Set legend title, colors and values manually
      $('#legend-title').text("What is the country policy's status?")
      const legendColors = ["#9272d9", "#20bdc5", "#F36744", "#999999", "#dbdbdb"]
      const legendValues = ["Active", "Expiring within 18 months", "Expired", "Data not available", "Out of scope"]

      // Now build legend
      buildLegend(legendColors, legendValues)

      }

    // Now, based on results of if statements and indicator selected, set map colors 
    map.setPaintProperty('country-boundaries', 'fill-color', caseExpression)

  };

  // Create function to sum countries with data available for denominator 
  function denominator(sumDenominator) {

    let denominatorArray = []

    csvData.forEach((row) => {
      if (row[sumDenominator] == "Yes" || row[sumDenominator] == "No") {
        denominatorArray.push(row.ISO_A3)
      } 
    })

    return denominatorSum = denominatorArray.length

  };

  // Create function to sum counts for tickers
  function sumIndicators(sumIndicatorName) {

    let indicatorArray = []

    csvData.forEach((row) => {
      if (row[sumIndicatorName] == "Yes") {
        indicatorArray.push(row.ISO_A3)
      }
    })

    return indicatorSum = indicatorArray.length

  };

  // Resize map to its container on map render
  map.on('render', function () {
    map.resize();
  });

  // On map load, load csv data, color the map, load top scorecards, and set up for populating sidebar and hovers
  map.on('load', () => {

    // Set zoom level based on device
    var laptop = window.matchMedia("(min-width: 768px)");

    if (laptop.matches) {
      map.setZoom(2.3);
    }
    else {
      map.setZoom(.5);
    };

    // Fetch CSV data - this is where CHIC team will update data quarterly
    const sheetId = '2PACX-1vRW71f12hsPrtlEglo73Xcit8TgFw1WeyU4HXWNV3M-IasQMjvzhS3zWjlFTgm4NHFs_1KJjHaSPLCZ'
    // REAL SPREADSHEET const sheetId = '2PACX-1vQan4RTDeRovJT7VqPhh15B6GLNhvxVGTILpyjOIfbfEEf2Sd0Ky5xpPsRlLS9_9GmHeWVIwNcIU5X8'
    fetch(`https://docs.google.com/spreadsheets/d/e/${sheetId}/pub?output=csv`)
      .catch(err => {})
      .then(resp => resp.text())
      .then(response => {
        csv().fromString(response)
          .then(rows => {
            csvData = rows

            // Add scorecard at top based on csv data
            const totalAccreditedAndSalaried = sumIndicators("at_least_1_salaried_accredited")
            const totalDenominator = denominator("at_least_1_salaried_accredited")
            $('#total-accredited-and-salaried').text(totalAccreditedAndSalaried + "/" + totalDenominator)

            // Initialize map with data for proCHW indicator
            setColorsToMap("salaried_accredited_cat")

            // Add button active state
            $('#accredited-and-salaried-chws-button').addClass('active');

            setTimeout(() => {
              map.setPaintProperty('country-boundaries', 'fill-opacity', 1)
            }, 1000)

          })
      })

    // Add event listeners for button clicks to change the map based on the indicator selected and toggle button to active state
    $("#accredited-chws-button").click(function () {
      setColorsToMap("at_least_1_accredited")
      $('.button').removeClass('active')
      $(this).addClass('active')
    })

    $("#salaried-chws-button").click(function () {
      setColorsToMap("at_least_1_salaried")
      $('.button').removeClass('active')
      $(this).addClass('active')
    })

    $("#accredited-and-salaried-chws-button").click(function () {
      setColorsToMap("salaried_accredited_cat")
      $('.button').removeClass('active')
      $(this).addClass('active')
    })

    $("#policy-status-button").click(function () {
      setColorsToMap("policy_status")
      $('.button').removeClass('active')
      $(this).addClass('active')
    })


    // Search functionality
    const searchInput = document.getElementById('country-search');
    const searchResults = document.getElementById('search-results');

    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase().trim();
      
      if (searchTerm.length === 0) {
        searchResults.style.display = 'none';
        return;
      }

      // Filter countries based on search term
      const filteredCountries = csvData.filter(country => 
        country.country.toLowerCase().includes(searchTerm)
      ).slice(0, 10); // Limit to 10 results

      if (filteredCountries.length > 0) {
        searchResults.innerHTML = '';
        filteredCountries.forEach(country => {
          const resultItem = document.createElement('div');
          resultItem.className = 'search-result-item';
          resultItem.textContent = country.country;
          resultItem.addEventListener('click', function() {
            // Clear previous country's data first
            clearPersistentData();
            
            // Find the country data and populate the sidebar
            const thisCountry = csvData.find(row => row.ISO_A3 === country.ISO_A3);
            
            if (thisCountry) {
              // Populate the sidebar with country information
              $("#country-name").text(thisCountry.country);
              $("#date-last-updated").text("Date last updated: " + thisCountry.date_last_updated);
              
              // Populate the entire sidebar
              populateSidebar(thisCountry);
              
              // Fly to the country using coordinates from CSV data
              if (thisCountry.longitude && thisCountry.latitude) {
                const lng = parseFloat(thisCountry.longitude);
                const lat = parseFloat(thisCountry.latitude);
                
                if (!isNaN(lng) && !isNaN(lat)) {
                  map.flyTo({
                    center: [lng, lat],
                    zoom: 3.5,
                    duration: 500,
                    essential: true
                  });
                }
              }
            }
            
            // Clear search
            searchInput.value = '';
            searchResults.style.display = 'none';
          });
          searchResults.appendChild(resultItem);
        });
        searchResults.style.display = 'block';
      } else {
        searchResults.innerHTML = '<div class="search-result-item">No countries found</div>';
        searchResults.style.display = 'block';
      }
    });

    // Hide search results when clicking outside
    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.style.display = 'none';
      }
    });

    // Hide search results when pressing Escape
    searchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        searchResults.style.display = 'none';
        this.blur();
      }
    });

    // CHW Cards functionality
    function populateCHWCards(countryData) {
      // Hide all popups when switching countries
      document.getElementById('total-chw-groups-popup').style.display = 'none';
      document.getElementById('salaried-accredited-popup').style.display = 'none';
      document.getElementById('chw-associations-popup').style.display = 'none';
      
      // Clear any existing "Data not available" text from popup titles
      const popupTitles = document.querySelectorAll('.chw-popup-title');
      popupTitles.forEach(title => {
        const dataNotAvailableText = title.querySelector('.data-not-available-text');
        if (dataNotAvailableText) {
          dataNotAvailableText.remove();
        }
      });
      
      // Check if country is out of scope
      if (countryData.countdown_country === "No") {
        document.getElementById('chw-cards-container').style.display = 'none';
        document.getElementById('out-of-scope-message').style.display = 'block';
        return;
      }

      // Show cards and hide out of scope message
      document.getElementById('chw-cards-container').style.display = 'flex';
      document.getElementById('out-of-scope-message').style.display = 'none';

      // Helper function to check if data is available
      function isDataAvailable(value) {
        return value && value !== "Data not available" && value !== "";
      }

      // Helper function to create list items from semicolon-separated string
      function createListItems(dataString, listElement) {
        listElement.innerHTML = '';
        if (isDataAvailable(dataString)) {
          const items = dataString.split(';').map(item => item.trim()).filter(item => item);
          items.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            listElement.appendChild(li);
          });
        } else {
          // For "Data not available", add italicized text after the title instead of bullets
          const popup = listElement.closest('.chw-popup');
          const title = popup.querySelector('.chw-popup-title');
          if (title && !title.querySelector('.data-not-available-text')) {
            const dataNotAvailableSpan = document.createElement('span');
            dataNotAvailableSpan.className = 'data-not-available-text';
            dataNotAvailableSpan.style.fontWeight = 'normal';
            dataNotAvailableSpan.style.fontStyle = 'italic';
            dataNotAvailableSpan.textContent = ' Data not available';
            title.appendChild(dataNotAvailableSpan);
          }
        }
      }

      // Populate Total CHW Groups Card
      const totalGroupsNumber = document.getElementById('total-chw-groups-number');
      const totalGroupsList = document.getElementById('total-chw-groups-list');
      
      if (isDataAvailable(countryData.group_count)) {
        totalGroupsNumber.textContent = countryData.group_count;
        totalGroupsNumber.className = 'chw-card-number';
      } else {
        totalGroupsNumber.textContent = 'Data not available';
        totalGroupsNumber.className = 'chw-card-number chw-card-number-not-available';
      }
      createListItems(countryData.group_names, totalGroupsList);

      // Populate Salaried & Accredited Card
      const salariedAccreditedNumber = document.getElementById('salaried-accredited-number');
      const salariedAccreditedList = document.getElementById('salaried-accredited-list');
      
      if (isDataAvailable(countryData.salaried_accredited_count)) {
        salariedAccreditedNumber.textContent = countryData.salaried_accredited_count;
        salariedAccreditedNumber.className = 'chw-card-number';
      } else {
        salariedAccreditedNumber.textContent = 'Data not available';
        salariedAccreditedNumber.className = 'chw-card-number chw-card-number-not-available';
      }
      createListItems(countryData.group_names_salaried_accredited, salariedAccreditedList);

      // Populate CHW Associations Card
      const associationsNumber = document.getElementById('chw-associations-number');
      const associationsList = document.getElementById('chw-associations-list');
      
      if (isDataAvailable(countryData.chw_associations_count)) {
        associationsNumber.textContent = countryData.chw_associations_count;
        associationsNumber.className = 'chw-card-number';
      } else {
        associationsNumber.textContent = 'Data not available';
        associationsNumber.className = 'chw-card-number chw-card-number-not-available';
      }
      createListItems(countryData.chw_association_names, associationsList);

      // Populate Policy Status Card
      const policyStatusBadge = document.getElementById('policy-status-badge');
      const policyStatus = countryData.policy_status || 'Data not available';
      
      // Remove existing status classes
      policyStatusBadge.classList.remove('out-of-scope', 'data-not-available', 'expired', 'active');
      
      // Add appropriate class and text based on policy status
      if (policyStatus === 'Out of Scope') {
        policyStatusBadge.classList.add('out-of-scope');
        policyStatusBadge.textContent = 'OUT OF SCOPE';
      } else if (policyStatus === 'Data not available') {
        policyStatusBadge.classList.add('data-not-available');
        policyStatusBadge.textContent = 'DATA NOT AVAILABLE';
      } else if (policyStatus === 'Expired' || policyStatus === 'Expiring within 18 months') {
        policyStatusBadge.classList.add('expired');
        policyStatusBadge.textContent = policyStatus.toUpperCase();
      } else if (policyStatus === 'Active') {
        policyStatusBadge.classList.add('active');
        policyStatusBadge.textContent = 'ACTIVE';
      } else {
        policyStatusBadge.classList.add('data-not-available');
        policyStatusBadge.textContent = policyStatus.toUpperCase();
      }
      
      // Populate implementation text
      const implementationText = document.getElementById('policy-implementation-text');
      implementationText.textContent = countryData.implementation_combined || 'Data not available';
      
      // Populate policy years text
      const policyYearsText = document.getElementById('policy-years-text');
      policyYearsText.textContent = countryData.policy_years_covered || 'Data not available';
      
      // Handle policy link
      const policyLink = document.getElementById('policy-link');
      const policyLinkContainer = document.getElementById('policy-link-container');
      
      if (countryData.policy_link && countryData.policy_link !== 'Data not available') {
        policyLink.href = countryData.policy_link;
        policyLink.textContent = 'View policy document ';
        policyLink.style.display = 'inline';
        policyLink.style.color = '';
        // Remove any "Policy not available" span if it exists
        const notAvailableSpan = policyLinkContainer.querySelector('span');
        if (notAvailableSpan) {
          notAvailableSpan.remove();
        }
      } else {
        policyLink.style.display = 'none';
        // Only add the "Policy not available" span if it doesn't already exist
        if (!policyLinkContainer.querySelector('span')) {
          const notAvailableSpan = document.createElement('span');
          notAvailableSpan.className = 'policy-link';
          notAvailableSpan.style.color = '#999999';
          notAvailableSpan.textContent = 'Policy not available';
          policyLinkContainer.appendChild(notAvailableSpan);
        }
      }

      // Populate Accreditation Subsections
      populateAccreditationSubsections(countryData);
      
      // Populate Policy Implementation Subsections
      populatePolicyImplementationSubsections(countryData);
    }

    // Function to populate accreditation subsections
    function populateAccreditationSubsections(countryData) {
      // Helper function to create indicator
      function createIndicator(value, indicatorElement, textElement) {
        if (value === "Yes") {
          indicatorElement.className = 'indicator-circle yes';
          indicatorElement.innerHTML = '';
          textElement.textContent = 'YES';
        } else if (value === "No") {
          indicatorElement.className = 'indicator-circle no';
          indicatorElement.innerHTML = '';
          textElement.textContent = 'NO';
        } else {
          indicatorElement.className = 'indicator-circle no';
          indicatorElement.innerHTML = '?';
          textElement.textContent = 'N/A';
        }
      }

      // Helper function to set description with quotes
      function setDescription(descriptionElement, value) {
        if (value && value !== "Data not available" && value !== "") {
          descriptionElement.textContent = `"${value}"`;
        } else {
          descriptionElement.textContent = '"Data not available"';
        }
      }

      // Helper function to set source link
      function setSource(sourceElement, sourceText, sourceLink) {
        if (sourceText && sourceText !== "Data not available" && sourceText !== "" && 
            sourceLink && sourceLink !== "Data not available" && sourceLink !== "") {
          sourceElement.innerHTML = `<a href="${sourceLink}" target="_blank">${sourceText}</a>`;
          // Add click event listener to prevent event bubbling
          const link = sourceElement.querySelector('a');
          if (link) {
            link.addEventListener('click', function(e) {
              e.stopPropagation();
            });
          }
        } else {
          sourceElement.textContent = '';
        }
      }

      // Accreditation (Column Z for yes/no, Column AA for description)
      createIndicator(
        countryData.accreditation_policy || 'Data not available',
        document.getElementById('accreditation-indicator'),
        document.getElementById('accreditation-text')
      );
      setDescription(
        document.getElementById('accreditation-description'),
        countryData.accreditation_quote
      );
      setSource(
        document.getElementById('accreditation-source'),
        countryData.accreditation_quote_source,
        countryData.accreditation_quote_source_link
      );

      // Salary (Column AD for yes/no, Column AE for description)
      createIndicator(
        countryData.salary_policy || 'Data not available',
        document.getElementById('salary-indicator'),
        document.getElementById('salary-text')
      );
      setDescription(
        document.getElementById('salary-description'),
        countryData.salary_quote
      );
      setSource(
        document.getElementById('salary-source'),
        countryData.salary_quote_source,
        countryData.salary_quote_source_link
      );

      // Supervision (Column AH for yes/no, Column AI for description)
      createIndicator(
        countryData.supervision_policy || 'Data not available',
        document.getElementById('supervision-indicator'),
        document.getElementById('supervision-text')
      );
      setDescription(
        document.getElementById('supervision-description'),
        countryData.supervision_quote
      );
      setSource(
        document.getElementById('supervision-source'),
        countryData.supervision_quote_source,
        countryData.supervision_quote_source_link
      );

      // Skills (Column AL for yes/no, Column AM for description)
      createIndicator(
        countryData.skills_policy || 'Data not available',
        document.getElementById('skills-indicator'),
        document.getElementById('skills-text')
      );
      setDescription(
        document.getElementById('skills-description'),
        countryData.skills_quote
      );
      setSource(
        document.getElementById('skills-source'),
        countryData.skills_quote_source,
        countryData.skills_quote_source_link
      );

      // Supplies (Column AP for yes/no, Column AQ for description)
      createIndicator(
        countryData.supplies_policy || 'Data not available',
        document.getElementById('supplies-indicator'),
        document.getElementById('supplies-text')
      );
      setDescription(
        document.getElementById('supplies-description'),
        countryData.supplies_quote
      );
      setSource(
        document.getElementById('supplies-source'),
        countryData.supplies_quote_source,
        countryData.supplies_quote_source_link
      );
    }

    // Function to populate policy implementation subsections
    function populatePolicyImplementationSubsections(countryData) {
      // Helper function to create indicator
      function createIndicator(value, indicatorElement, textElement) {
        if (value === "Yes") {
          indicatorElement.className = 'indicator-circle yes';
          indicatorElement.innerHTML = '';
          textElement.textContent = 'YES';
        } else if (value === "No") {
          indicatorElement.className = 'indicator-circle no';
          indicatorElement.innerHTML = '';
          textElement.textContent = 'NO';
        } else {
          indicatorElement.className = 'indicator-circle no';
          indicatorElement.innerHTML = '?';
          textElement.textContent = 'N/A';
        }
      }

      // Helper function to set description with quotes
      function setDescription(descriptionElement, value) {
        if (value && value !== "Data not available" && value !== "") {
          descriptionElement.textContent = `"${value}"`;
        } else {
          descriptionElement.textContent = '"Data not available"';
        }
      }

      // Helper function to set source link
      function setSource(sourceElement, sourceText, sourceLink) {
        if (sourceText && sourceText !== "Data not available" && sourceText !== "" && 
            sourceLink && sourceLink !== "Data not available" && sourceLink !== "") {
          sourceElement.innerHTML = `<a href="${sourceLink}" target="_blank">${sourceText}</a>`;
          // Add click event listener to prevent event bubbling
          const link = sourceElement.querySelector('a');
          if (link) {
            link.addEventListener('click', function(e) {
              e.stopPropagation();
            });
          }
        } else {
          sourceElement.textContent = '';
        }
      }

      // Domestic Financing Commitment
      createIndicator(
        countryData.domestic_financing_commitment || 'Data not available',
        document.getElementById('domestic-financing-commitment-indicator'),
        document.getElementById('domestic-financing-commitment-text')
      );
      setDescription(
        document.getElementById('domestic-financing-commitment-description'),
        countryData.domestic_financing_commitment_quote
      );
      setSource(
        document.getElementById('domestic-financing-commitment-source'),
        countryData.domestic_financing_commitment_quote_source,
        countryData.domestic_financing_commitment_quote_source_link
      );

      // CHW Budget Line Item
      createIndicator(
        countryData.chw_budget_line_item || 'Data not available',
        document.getElementById('chw-budget-line-item-indicator'),
        document.getElementById('chw-budget-line-item-text')
      );
      setDescription(
        document.getElementById('chw-budget-line-item-description'),
        countryData.chw_budget_line_item_quote
      );
      setSource(
        document.getElementById('chw-budget-line-item-source'),
        countryData.chw_budget_line_item_quote_source,
        countryData.chw_budget_line_item_quote_source_link
      );

      // Data Systems / Feedback Loops
      createIndicator(
        countryData.data_systems || 'Data not available',
        document.getElementById('data-systems-indicator'),
        document.getElementById('data-systems-text')
      );
      setDescription(
        document.getElementById('data-systems-description'),
        countryData.data_systems_quote
      );
      setSource(
        document.getElementById('data-systems-source'),
        countryData.data_systems_quote_source,
        countryData.data_systems_quote_source_link
      );

      // MERL / M&E Framework
      createIndicator(
        countryData.merl || 'Data not available',
        document.getElementById('merl-indicator'),
        document.getElementById('merl-text')
      );
      setDescription(
        document.getElementById('merl-description'),
        countryData.merl_quote
      );
      setSource(
        document.getElementById('merl-source'),
        countryData.merl_quote_source,
        countryData.merl_quote_source_link
      );

      // CHW Registry
      createIndicator(
        countryData.chw_registry || 'Data not available',
        document.getElementById('chw-registry-indicator'),
        document.getElementById('chw-registry-text')
      );
      setDescription(
        document.getElementById('chw-registry-description'),
        countryData.chw_registry_quote
      );
      setSource(
        document.getElementById('chw-registry-source'),
        countryData.chw_registry_quote_source,
        countryData.chw_registry_quote_source_link
      );
    }

    // Add click event listeners for CHW cards
    document.getElementById('total-chw-groups-card').addEventListener('click', function() {
      // Hide all other popups first
      document.getElementById('salaried-accredited-popup').style.display = 'none';
      document.getElementById('chw-associations-popup').style.display = 'none';
      
      // Toggle the clicked popup
      const popup = document.getElementById('total-chw-groups-popup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    });

    document.getElementById('salaried-accredited-card').addEventListener('click', function() {
      // Hide all other popups first
      document.getElementById('total-chw-groups-popup').style.display = 'none';
      document.getElementById('chw-associations-popup').style.display = 'none';
      
      // Toggle the clicked popup
      const popup = document.getElementById('salaried-accredited-popup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    });

    document.getElementById('chw-associations-card').addEventListener('click', function() {
      // Hide all other popups first
      document.getElementById('total-chw-groups-popup').style.display = 'none';
      document.getElementById('salaried-accredited-popup').style.display = 'none';
      
      // Toggle the clicked popup
      const popup = document.getElementById('chw-associations-popup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    });

    // Add click event listener for accreditation section
    const accreditationSection = document.getElementById('accreditation-section');
    if (accreditationSection) {
      accreditationSection.addEventListener('click', function() {
        const content = this.querySelector('.accreditation-section-content');
        const isExpanded = this.classList.contains('expanded');
        
        if (isExpanded) {
          content.style.display = 'none';
          this.classList.remove('expanded');
        } else {
          content.style.display = 'block';
          this.classList.add('expanded');
        }
      });
    }

    // Add click event listener for policy implementation section
    const policyImplementationSection = document.getElementById('policy-implementation-section');
    if (policyImplementationSection) {
      policyImplementationSection.addEventListener('click', function() {
        const content = this.querySelector('.accreditation-section-content');
        const isExpanded = this.classList.contains('expanded');
        
        if (isExpanded) {
          content.style.display = 'none';
          this.classList.remove('expanded');
        } else {
          content.style.display = 'block';
          this.classList.add('expanded');
        }
      });
    }

    // Add click event listener for policy timeline section
    const policyTimelineSection = document.getElementById('policy-timeline-section');
    if (policyTimelineSection) {
      policyTimelineSection.addEventListener('click', function() {
        const content = this.querySelector('.accreditation-section-content');
        const isExpanded = this.classList.contains('expanded');
        
        if (isExpanded) {
          content.style.display = 'none';
          this.classList.remove('expanded');
        } else {
          content.style.display = 'block';
          this.classList.add('expanded');
        }
      });
    }

    // Function to clear persistent data that might carry over between countries
    function clearPersistentData() {
      // Clear all subsections (these were persisting)
      clearAllSubsections();
      
      // Collapse all expandable sections
      document.getElementById('accreditation-section').classList.remove('expanded');
      document.getElementById('accreditation-section').querySelector('.accreditation-section-content').style.display = 'none';
      document.getElementById('policy-implementation-section').classList.remove('expanded');
      document.getElementById('policy-implementation-section').querySelector('.accreditation-section-content').style.display = 'none';
      document.getElementById('policy-timeline-section').classList.remove('expanded');
      document.getElementById('policy-timeline-section').querySelector('.accreditation-section-content').style.display = 'none';
    }

    // Function to clear all subsections (accreditation and policy implementation)
    function clearAllSubsections() {
      // Clear accreditation subsections
      const accreditationSubsections = ['accreditation', 'salary', 'supervision', 'skills', 'supplies'];
      
      accreditationSubsections.forEach(subsection => {
        const indicator = document.getElementById(`${subsection}-indicator`);
        const text = document.getElementById(`${subsection}-text`);
        const description = document.getElementById(`${subsection}-description`);
        const source = document.getElementById(`${subsection}-source`);
        
        if (indicator) {
          indicator.className = 'indicator-circle';
          indicator.innerHTML = '';
        }
        if (text) {
          text.textContent = '';
        }
        if (description) {
          description.textContent = '';
        }
        if (source) {
          source.textContent = '';
        }
      });

      // Clear policy implementation subsections
      const policyImplementationSubsections = [
        'domestic-financing-commitment', 
        'chw-budget-line-item', 
        'data-systems', 
        'merl', 
        'chw-registry'
      ];
      
      policyImplementationSubsections.forEach(subsection => {
        const indicator = document.getElementById(`${subsection}-indicator`);
        const text = document.getElementById(`${subsection}-text`);
        const description = document.getElementById(`${subsection}-description`);
        const source = document.getElementById(`${subsection}-source`);
        
        if (indicator) {
          indicator.className = 'indicator-circle';
          indicator.innerHTML = '';
        }
        if (text) {
          text.textContent = '';
        }
        if (description) {
          description.textContent = '';
        }
        if (source) {
          source.textContent = '';
        }
      });
    }

    // Function to populate the entire sidebar
    function populateSidebar(countryData) {
      if (countryData.countdown_country === "No") {
        // Country is out of scope - show only out of scope message
        document.getElementById('out-of-scope-message').style.display = 'block';
        document.getElementById('out-of-scope-message').textContent = "This country is not a Countdown to 2030 country, so it is out of scope for this dashboard.";
        
        // Hide all other elements
        document.getElementById('chw-cards-container').style.display = 'none';
        document.getElementById('chw-popups-container').style.display = 'none';
        document.getElementById('policy-status-card').style.display = 'none';
        document.getElementById('accreditation-section').style.display = 'none';
        document.getElementById('policy-implementation-section').style.display = 'none';
        document.getElementById('policy-timeline-section').style.display = 'none';
      } else {
        // Country is in scope - show everything
        document.getElementById('out-of-scope-message').style.display = 'none';
        
        // Show all elements
        document.getElementById('chw-cards-container').style.display = 'flex';
        document.getElementById('policy-status-card').style.display = 'block';
        document.getElementById('accreditation-section').style.display = 'block';
        document.getElementById('policy-implementation-section').style.display = 'block';
        document.getElementById('policy-timeline-section').style.display = 'block';
        
        // Populate CHW cards and policy status
        populateCHWCards(countryData);
      }
    }

    // Populate sidebar upon click
    map.on('click', 'country-boundaries', (e) => {
      // Clear previous country's data first
      clearPersistentData();

      const thisCountry = csvData.find(row => row.ISO_A3 === e.features[0].properties.iso_3166_1_alpha_3)

      if (thisCountry) {

        $("#country-name").text(thisCountry.country)
        $("#date-last-updated").text("Date last updated: " + thisCountry.date_last_updated)
        
        // Populate the entire sidebar
        populateSidebar(thisCountry)
      }

    });

    // Create popup on hover
    const popup = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
    });

    map.on('mousemove', 'country-boundaries', (e) => {

      map.getCanvas().style.cursor = 'pointer'

      const thisCountry = csvData.find(row => row.ISO_A3 === e.features[0].properties.iso_3166_1_alpha_3)

      if (thisCountry) {

        popup.setLngLat(e.lngLat)
          .setHTML(
            `
                        <div>
                        ${thisCountry.country}<br> 
                        At least 1 group accredited:
                        ${thisCountry.at_least_1_accredited}<br>
                        At least 1 group salaried:
                        ${thisCountry.at_least_1_salaried}
                        </div>
                        `
          )
          .addTo(map)

      }

    });

    map.on('mouseleave', 'country-boundaries', (e) => {

      map.getCanvas().style.cursor = '';
      popup.remove();

    });

    // Create hover on buttons with definitions
    $("#accredited-chws-button").hover(function () {
      $('.accredited-chws-button-def').show();
    }, function () {
      $('.accredited-chws-button-def').hide();
    })

    $("#salaried-chws-button").hover(function () {
      $('.salaried-chws-button-def').show()
    }, function () {
      $('.salaried-chws-button-def').hide();
    })

    $("#accredited-and-salaried-chws-button").hover(function () {
      $('.accredited-and-salaried-chws-button-def').show()
    }, function () {
      $('.accredited-and-salaried-chws-button-def').hide();
    })

    $("#policy-status-button").hover(function () {
      $('.policy-status-button-def').show()
    }, function () {
      $('.policy-status-button-def').hide();
    })

  });

</script>

</body>

</html>